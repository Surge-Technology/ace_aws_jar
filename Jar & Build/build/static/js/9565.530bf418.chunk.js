"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9565],{83525:function(e,n,a){a.d(n,{Z:function(){return h}});var t=a(72791),r=a(65764),c=a(53473),s=a(74165),o=a(15861),i=a(29439),l=a(57689),u=a(9085),d=a(80184);function m(){var e=(0,t.useState)(!1),n=(0,i.Z)(e,2),a=n[0],c=n[1],m=(0,t.useState)(null),p=(0,i.Z)(m,2),h=p[0],x=p[1],j=(0,t.useState)(""),g=(0,i.Z)(j,2),y=g[0],f=g[1],N=(0,t.useState)(!0),b=(0,i.Z)(N,2),v=b[0],X=b[1],_=(0,t.useState)(""),C=(0,i.Z)(_,2),Z=C[0],D=C[1],A=(0,r.useStripe)(),P=(0,r.useElements)(),B=(0,l.s0)();(0,t.useEffect)((function(){var e=localStorage.getItem("clientSecret");D(e)}),[]);var q=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X(n.empty),x(n.error?n.error.message:"");case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=function(){var e=(0,o.Z)((0,s.Z)().mark((function e(n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),f(!0),e.next=4,A.confirmCardPayment(Z,{payment_method:{card:P.getElement(r.CardElement)}});case 4:(a=e.sent).error?(x("Payment failed ".concat(a.error.message)),f(!1)):(x(null),f(!1),c(!0),u.Am.success("Card payment complated",{theme:"colored"}),setTimeout((function(){B("/studentTabs/2")}),1e3));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u.Ix,{}),(0,d.jsxs)("form",{id:"payment-form",onSubmit:I,children:[(0,d.jsx)(r.CardElement,{id:"card-element",options:{style:{}},onChange:q}),(0,d.jsx)("button",{disabled:y||v||a,id:"submit",children:(0,d.jsx)("span",{id:"button-text",children:y?(0,d.jsx)("div",{className:"spinner",id:"spinner"}):"Pay now"})}),h&&(0,d.jsx)("div",{className:"card-error",role:"alert",children:h})]})]})}var p=(0,c.J)("pk_test_51N8zAjSDZZDbPYcfYOVoru76gg0RDy1rtyB5W9KGaRVPv623oNLc4YQruLY0CgUExb0tNaN65j2kKXbVUAxWtzKS00rinFrRll");function h(){return(0,t.useEffect)((function(){console.log("process.env.REACT_APP_BASE_SPRIPE_KEY","pk_test_51N8zAjSDZZDbPYcfYOVoru76gg0RDy1rtyB5W9KGaRVPv623oNLc4YQruLY0CgUExb0tNaN65j2kKXbVUAxWtzKS00rinFrRll")}),[]),(0,d.jsx)("div",{className:"App",children:(0,d.jsx)(r.Elements,{stripe:p,children:(0,d.jsx)(m,{})})})}},39565:function(e,n,a){a.d(n,{Z:function(){return A}});var t=a(1413),r=a(29439),c=a(72791),s=a(57689),o=a(84951),i=a(18491),l=a(24021),u=a(22976),d=a(77710),m=a(63263),p=a(21830),h=a.n(p),x=a(59513),j=a.n(x),g=a(9085),y=a(72426),f=a.n(y),N=a(83525),b=a(80184),v={cardType:"",expireDate:"",cardNumber:"",pin:"",currency:"",description:""},X={date:"",payeeName:"",chequeNo:"",accountNo:"",routingNo:""},_={accountNo:"",routingNo:""},C={cardType:"",expireDate:"",cardNumber:"",pin:"",currency:"",currencyOptions:[{value:"usd",label:"usd"}],description:"",paymentType:"",accountNo:"",routingNo:"",chargeAmount:"",date:"",payeeName:"",chequeNo:"",frontPictureAttachment:"",backPictureAttachment:"",paymentTypeOptions:"",loader:!1,stripeModalToggle:!1},Z={paymentType:l.object().required("Payment Type is required")},D=f()(new Date).format("YYYY-MM-DD");function A(e){var n=(0,c.useState)(C),a=(0,r.Z)(n,2),p=a[0],x=a[1],y=(p.cardType,p.expireDate,p.currency),A=(p.cardNumber,p.pin,p.currencyOptions),P=(p.description,p.paymentType),B=(p.accountNo,p.routingNo,p.chargeAmount),q=(p.date,p.payeeName,p.chequeNo,p.frontPictureAttachment),I=p.backPictureAttachment,T=p.paymentTypeOptions,Y=p.loader,k=p.stripeModalToggle,J=(0,s.s0)(),R=function(e){return l.object().shape(e)},S=function(){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{stripeModalToggle:!k})}))};(0,c.useEffect)((function(){d.Z.get("payment-types").then((function(n){var a=[];n.data.map((function(e,n){a.push({value:e.id,label:e.name})})),x((function(n){return(0,t.Z)((0,t.Z)({},n),{},{paymentTypeOptions:a,chargeAmount:e.contractFee})}))})).catch((function(e){h().fire(e.response.data.message,"Please try again ")}))}),[]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Ix,{}),Y?(0,b.jsx)(o.$j,{className:"loaderr",color:"primary",children:"Loading..."}):null,(0,b.jsxs)(o.u_,{isOpen:k,toggle:function(){return S()},backdrop:"static",centered:!0,children:[(0,b.jsx)(o.xB,{toggle:function(){return S()},children:"Card payment"}),(0,b.jsx)(o.fe,{children:(0,b.jsx)(N.Z,{})})]}),(0,b.jsx)(i.J9,{enableReinitialize:!0,initialValues:C,validationSchema:R(Z),onSubmit:function(n){var a=n;if(a.frontPictureAttachment=q,a.backPictureAttachment=I,"Cheque"===P.label&&""===q&&h().fire("Upload Front Picture","Cheque"),"Cheque"===P.label&&""===I)h().fire("Upload Back Picture","Cheque");else if(void 0!==e.contractDetails){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!0})}));var r={contract:{pricing:{id:e.contractDetails.member.value,fee:e.contractDetails.fee,discount:e.contractDetails.discount,totalFee:e.contractDetails.totalFee,members:e.contractDetails.member.label,subscriptionFrequency:{id:e.contractDetails.membersAndFrequency.value,name:e.contractDetails.membersAndFrequency.label}},startDate:f()(e.contractDetails.startDate).format("YYYY-MM-DD"),endDate:f()(e.contractDetails.endDate).format("YYYY-MM-DD"),attachment:e.contractDetails.contractImageName}};"AutoPay"===P.label&&(r.autoPay={accountNumber:n.accountNo,routingNumber:n.routingNo,chargeAmount:n.chargeAmount}),"Card"===P.label&&(r.usAePayCardPaymentResponse={amount:n.chargeAmount,currency:n.currency.value,description:n.description,cardNumber:n.cardNumber,cardExpiryDate:f()(n.expireDate).format("YYYY-MM-DD"),cardCode:n.pin}),"Cheque"===P.label&&(r.usAePayChequePayment={payeeName:n.payeeName,chequeNumber:n.chequeNo,date:f()(n.date).format("YYYY-MM-DD"),amount:n.chargeAmount,frontPictureAttachment:n.frontPictureAttachment,backPictureAttachment:n.backPictureAttachment,checkAccountNumber:n.accountNo,checkRoutingNumber:n.routingNo}),h().fire({title:"Are you sure?",text:"You want to update!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes"}).then((function(a){a.isConfirmed?(m.Z.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("token"),m.Z.post("".concat("http://13.59.87.195:8080/api/v1/api","/payment-type/").concat(n.paymentType.value,"/contract-promotion/").concat(e.contractDetails.contractPromotion.value,"/contract-status/").concat(e.contractDetails.contractStatus.label,"/student/").concat(e.studentId),r).then((function(n){g.Am.success("Updated successfully",{theme:"colored"}),console.log("res",n),r.cardPaymentResponse?(localStorage.setItem("clientSecret",n.data.cardPaymentResponse.clientSecret),x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{stripeModalToggle:!k,loader:!1})}))):setTimeout((function(){e.sendData("payment"),J("/studentTabs/2"),x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!1})}))}),1e3)})).catch((function(e){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!1})})),h().fire(e.response.data.message,"Please try again ")}))):x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!1})}))}))}else e.sendData(a)},children:function(n){var a=n.values,r=n.setFieldValue,c=n.handleChange,s=n.handleBlur,d=(n.handleSubmit,n.errors),p=n.touched;return(0,b.jsxs)(i.l0,{children:[(0,b.jsxs)(o.fe,{children:[(0,b.jsxs)(o.X2,{children:[(0,b.jsx)(o.JX,{md:3,children:(0,b.jsx)(o.__,{children:"Payment Type  "})}),(0,b.jsxs)(o.JX,{nd:6,children:[(0,b.jsx)(u.ZP,{name:"paymentType",defaultValue:P,onChange:function(e){var n;r("paymentType",e),Z={},"Card"===(n=e).label&&(Object.keys(v).map((function(e){Z[e]="currency"===e?l.object().required("Field is required"):l.string().required("Field is required")})),R(Z)),"Cheque"===n.label&&(Object.keys(X).map((function(e){Z[e]=l.string().required("Field is required")})),R(Z)),"AutoPay"===n.label&&(Object.keys(_).map((function(e){"routingNo"===e&&(Z[e]=l.string().min(9,"Minimum length 9 is required").required("Field is required")),"accountNo"===e&&(Z[e]=l.string().min(9,"Minimum 9 digits required").max(16,"Maximum 16 digits required").required("Field is required"))})),R(Z)),x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{paymentType:n})}))},options:T}),(0,b.jsx)(i.Bc,{name:"paymentType",component:"div",className:"errmsg"})]})]}),(0,b.jsx)("span",{className:"displayNone",children:a.chargeAmount=B}),"AutoPay"===P.label?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"height15"}),(0,b.jsxs)(o.X2,{children:[(0,b.jsx)(o.JX,{md:1}),(0,b.jsx)(o.JX,{md:3,children:(0,b.jsxs)(o.__,{children:[" Account No  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsxs)(o.JX,{md:5,children:[(0,b.jsx)(o.II,{name:"accountNo",type:"number",value:a.accountNo,onChange:c,onBlur:s,invalid:p.accountNo&&!!d.accountNo}),(0,b.jsx)(i.Bc,{name:"accountNo",component:"div",className:"errmsg"})]})]}),(0,b.jsx)("div",{className:"height15"}),(0,b.jsxs)(o.X2,{children:[(0,b.jsx)(o.JX,{md:1}),(0,b.jsx)(o.JX,{md:3,children:(0,b.jsxs)(o.__,{children:[" Routing No  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsxs)(o.JX,{md:5,children:[(0,b.jsx)(o.II,{name:"routingNo",type:"number",value:a.routingNo,onChange:c,onBlur:s,invalid:p.routingNo&&!!d.routingNo}),(0,b.jsx)(i.Bc,{name:"routingNo",component:"div",className:"errmsg"})]})]})," ",(0,b.jsx)("div",{className:"height15"}),(0,b.jsxs)(o.X2,{children:[(0,b.jsx)(o.JX,{md:4,children:(0,b.jsx)(o.__,{children:(0,b.jsx)("span",{children:"Charge Amount $"})})}),(0,b.jsx)(o.JX,{md:5,children:(0,b.jsx)(o.II,{name:"chargeAmount",type:"text",value:B,disabled:!0,onChange:c,onBlur:s})})]})]}):"Card"===P.label?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Card Type  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})," "]}),(0,b.jsx)(o.II,{name:"cardType",type:"text",value:a.cardType,placeholder:"ex:-visa",onChange:c,onBlur:s,invalid:p.cardType&&!!d.cardType}),(0,b.jsx)(i.Bc,{name:"cardType",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsxs)("span",{children:["expire Date  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsx)(j(),{name:"expireDate",min:D,dateFormat:"MMM yyy",selected:a.expireDate?new Date(a.expireDate):null,onChange:function(e){r("expireDate",e)},showMonthYearPicker:!0,onBlur:s}),(0,b.jsx)(i.Bc,{name:"expireDate",component:"div",className:"errmsg"})]})]}),(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Card Number   ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]}),(0,b.jsx)(o.II,{name:"cardNumber",type:"number",value:a.cardNumber,placeholder:"XXXXX XXXXX XXXXX",onChange:c,onBlur:s,invalid:p.cardNumber&&!!d.cardNumber}),(0,b.jsx)(i.Bc,{name:"cardNumber",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Pin  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})," "]}),(0,b.jsx)(o.II,{name:"pin",type:"number",value:a.pin,placeholder:"XXX",onChange:c,onBlur:s,invalid:p.pin&&!!d.pin}),(0,b.jsx)(i.Bc,{name:"pin",component:"div",className:"errmsg"})]})]}),(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Currency  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})," "]}),(0,b.jsx)(u.ZP,{name:"currency",defaultValue:y,onChange:function(e){r("currency",e)},options:A}),(0,b.jsx)(i.Bc,{name:"currency",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsx)("span",{children:"Charge Amount $"})}),(0,b.jsx)(o.II,{name:"chargeAmount",type:"text",value:B,disabled:!0,onChange:c,onBlur:s})]}),(0,b.jsxs)(o.JX,{children:[(0,b.jsxs)(o.__,{children:[" description   ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]}),(0,b.jsx)(o.II,{name:"description",type:"text",value:a.description,onChange:c,onBlur:s,invalid:p.description&&!!d.description}),(0,b.jsx)(i.Bc,{name:"description",component:"div",className:"errmsg"})]})]})]}):"Cheque"===P.label?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsxs)("span",{children:["Date  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsx)(j(),{name:"date",selected:a.date?new Date(a.date):null,onChange:function(e){r("date",e)},onBlur:s,placeholderText:"mm/dd/yyyy"}),(0,b.jsx)(i.Bc,{name:"date",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsxs)("span",{children:["Payee Name  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsx)(o.II,{name:"payeeName",type:"text",value:a.payeeName,onChange:c,onBlur:s,invalid:p.payeeName&&!!d.payeeName}),(0,b.jsx)(i.Bc,{name:"payeeName",component:"div",className:"errmsg"})]})]}),(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsxs)("span",{children:["Cheque No.  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsx)(o.II,{name:"chequeNo",type:"text",value:a.chequeNo,onChange:c,onBlur:s,invalid:p.chequeNo&&!!d.chequeNo}),(0,b.jsx)(i.Bc,{name:"chequeNo",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.__,{children:(0,b.jsx)("span",{children:"Charge Amount $"})}),(0,b.jsx)(o.II,{name:"chargeAmount",type:"text",value:B,disabled:!0,onChange:c,onBlur:s})]})]}),(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Account No  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]}),(0,b.jsx)(o.II,{name:"accountNo",type:"number",value:a.accountNo,onChange:c,onBlur:s,invalid:p.accountNo&&!!d.accountNo}),(0,b.jsx)(i.Bc,{name:"accountNo",component:"div",className:"errmsg"})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsxs)(o.__,{children:[" Routing No  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]}),(0,b.jsx)(o.II,{name:"routingNo",type:"number",value:a.routingNo,onChange:c,onBlur:s,invalid:p.routingNo&&!!d.routingNo}),(0,b.jsx)(i.Bc,{name:"routingNo",component:"div",className:"errmsg"})]})]}),(0,b.jsxs)(o.X2,{children:[(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.X2,{children:(0,b.jsxs)(o.JX,{children:[(0,b.jsx)(o.__,{children:(0,b.jsx)("span",{children:"front Picture Attachment"})}),(0,b.jsxs)("span",{className:"btn btn-primary btn-file",children:["Upload  Front  ",(0,b.jsx)("input",{type:"file",onChange:function(e){return function(e){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!0})}));var n=new FormData;n.append("image",e.target.files[0]),m.Z.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("token"),m.Z.post("".concat("http://13.59.87.195:8080/api/v1/api","/files/chequefrontimage/upload"),n).then((function(e){x((function(n){return(0,t.Z)((0,t.Z)({},n),{},{frontPictureAttachment:e.data.imageName,loader:!1})}))})).catch((function(e){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!1})})),h().fire(e.response.data.message,"Please try again later")}))}(e)}})]})]})}),(0,b.jsx)(o.X2,{children:(0,b.jsxs)("span",{children:[" ",q?(0,b.jsx)("b",{style:{color:"green"},children:"Successfully Uploaded"}):null]})})]}),(0,b.jsxs)(o.JX,{md:6,children:[(0,b.jsx)(o.X2,{children:(0,b.jsxs)(o.JX,{children:[(0,b.jsx)(o.__,{children:(0,b.jsxs)("span",{children:["back Picture Attachment  ",(0,b.jsx)("span",{className:"colorRed",children:"*"})]})}),(0,b.jsxs)("span",{className:"btn btn-primary btn-file",children:["Upload Back  ",(0,b.jsx)("input",{type:"file",onChange:function(e){return function(e){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!0})}));var n=new FormData;n.append("image",e.target.files[0]),m.Z.defaults.headers.common.Authorization="Bearer "+localStorage.getItem("token"),m.Z.post("".concat("http://13.59.87.195:8080/api/v1/api","/files/chequefrontimage/upload"),n).then((function(e){console.log("image",e),x((function(n){return(0,t.Z)((0,t.Z)({},n),{},{backPictureAttachment:e.data.imageName,loader:!1})}))})).catch((function(e){x((function(e){return(0,t.Z)((0,t.Z)({},e),{},{loader:!1})})),h().fire(e.response.data.message,"Please try again later")}))}(e)}})]})]})}),(0,b.jsx)(o.X2,{children:(0,b.jsxs)("span",{children:[" ",I?(0,b.jsx)("b",{style:{color:"green"},children:"Successfully Uploaded"}):null]})})]})]})]}):null]}),(0,b.jsxs)(o.mz,{children:[(0,b.jsx)(o.zx,{type:"button",color:"secondary",size:"sm",onClick:function(){return e.sendData("payment")},children:"Cancel"}),(0,b.jsx)(o.zx,{type:"submit",color:"primary",size:"sm",children:"Save"})]})]})}})]})}}}]);
//# sourceMappingURL=9565.530bf418.chunk.js.map